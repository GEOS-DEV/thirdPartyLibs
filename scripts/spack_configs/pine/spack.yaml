# This is a Spack Environment file for Pine (Spack 1.0.2) 
# Run command from the top-level of the repository:
# ./scripts/uberenv/uberenv.py                                  \
#    --spec "~openmp~pygeosx~docs"                              \
#    --spack-env-file=scripts/spack_configs/pine/spack.yaml     \
#    --project-json=.uberenv_config.json                        \
#    --prefix ${GEOS_TPL_DIR}

spack:
  config:
    install_tree:
      root: $spack/..
      projections:
        all: '{compiler.name}-{compiler.version}/{name}-{version}-{hash}'
    misc_cache: $spack/../misc_cache
    test_stage: $spack/../test_stage
    build_stage:
      - $spack/../build_stage
    build_jobs: 16

  view: false

  include:
  - ../defaults.yaml
  - ../versions.yaml

  toolchains:
    gcc-11:
    - spec: '%c=gcc@11.4.1'
      when: '%c'
    - spec: '%cxx=gcc@11.4.1'
      when: '%cxx'
    - spec: '%fortran=gcc@11.4.1'
      when: '%fortran'
    - spec: '%openmpi@5.0.5'
      when: '%mpi'

  packages:
    all:
      target: [zen4]
      providers:
        blas: [openblas]
        lapack: [openblas]
        mpi: [openmpi]
        zlib-api: [zlib]
        pkgconfig: [pkgconf]

    # Force Spack to build openblas, not use system version
    openblas:
      buildable: true
      require: "@0.3.27 threads=none"

    # Disable unwanted compilers
    nvhpc:
      buildable: false
    intel:
      buildable: false
    oneapi:
      buildable: false
    cce:
      buildable: false
    llvm-amdgpu:
      buildable: false

    gcc:
      externals:
      - spec: gcc@=11.4.1
        prefix: /usr
        extra_attributes:
          compilers:
            c: /usr/bin/gcc
            cxx: /usr/bin/g++
            fortran: /usr/bin/gfortran
          flags:
            cflags: -march=native -mtune=native
            cxxflags: -march=native -mtune=native
          environment: {}
          extra_rpaths: []
      buildable: false

    gcc-runtime:
      buildable: false
      externals:
      - spec: gcc-runtime@11.4.1
        prefix: /usr/lib/gcc/x86_64-redhat-linux/11

    gmp:
      externals:
      - spec: gmp@6.3.0
        prefix: /hrtc/apps/devtools/spack/PINE/linux-rocky9-zen4/gcc-11.4.1/gmp-6.3.0-q4glkxa77fd4rejkrrsuydut2c222fkm
      buildable: false

    mpfr:
      externals:
      - spec: mpfr@4.2.0
        prefix: /hrtc/apps/devtools/spack/PINE/linux-rocky9-zen4/gcc-11.4.1/mpfr-4.2.1-eaxjflobjpilpwfe4aalusexhcxhptrf
      buildable: false

    libiconv:
      externals:
      - spec: libiconv@1.17
        prefix: /hrtc/apps/devtools/spack/PINE/linux-rocky9-zen4/gcc-11.4.1/libiconv-1.17-crgtppb7hj54qwkl3hfc6ejyu34gsa4d
      buildable: false

    perl:
      externals:
      - spec: perl@5.38.2
        prefix: /hrtc/apps/devtools/spack/PINE/linux-rocky9-zen4/gcc-11.4.1/perl-5.38.2-wxq42supt6zs3f63ajjtp6423q6teyot
      buildable: false

    berkeley-db:
      externals:
      - spec: berkeley-db@18.1.40
        prefix: /hrtc/apps/devtools/spack/PINE/linux-rocky9-zen4/gcc-11.4.1/berkeley-db-18.1.40-nixwddyxlb523z3aly4b7bje4rfft3me
      buildable: false

    cmake:
      externals:
      - spec: cmake@3.29.6
        prefix: /hrtc/apps/devtools/spack/PINE/linux-rocky9-zen4/gcc-11.4.1/cmake-3.29.6-i23jd7kq7lyqvrpsguhznfhoy4mso6up
      buildable: false

    git:
      externals:
      - spec: git@2.39.3~tcltk
        prefix: /usr
      buildable: false

    gmake:
      externals:
      - spec: gmake@4.3
        prefix: /usr
      buildable: false

    m4:
      externals:
      - spec: m4@1.4.19
        prefix: /usr
      buildable: false

    python:
      buildable: false
      externals:
      - spec: python@3.9.18
        prefix: /usr

    bison:
      buildable: false
      externals:
      - spec: bison@3.8.2
        prefix: /usr

    ninja:
      buildable: false
      externals:
      - spec: ninja@1.10.2
        prefix: /usr

    openmpi:
      externals:
      - spec: openmpi@5.0.5
        prefix: /hrtc/apps/mpi/openmpi/x86_64/rocky9/5.0.5/gcc/11.4.1/nocuda/
      buildable: false

    pkgconf:
      externals:
      - spec: pkgconf@3.0.0
        prefix: /usr
      buildable: false

    readline:
      externals:
      - spec: readline@8.1
        prefix: /usr
      buildable: false

    zlib:
      buildable: false
      externals:
      - spec: zlib@1.2.11
        prefix: /usr

  concretizer:
    unify: true
    reuse: false
